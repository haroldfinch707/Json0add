<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Scanner - Processed Data</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Dark Theme (Default) */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            font-size: 13px;
            line-height: 1.4;
            transition: all 0.3s ease;
        }

        /* Light Theme */
        body.light-theme {
            background-color: #ffffff;
            color: #333333;
        }

        .header {
            background-color: #2d2d2d;
            padding: 12px 20px;
            border-bottom: 1px solid #404040;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .light-theme .header {
            background-color: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-subtitle {
            color: #888;
            font-size: 12px;
        }

        .light-theme .header-subtitle {
            color: #666;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background-color: #404040;
            color: #fff;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: #4a4a4a;
        }

        .light-theme .btn {
            background-color: #e0e0e0;
            color: #333;
        }

        .light-theme .btn:hover {
            background-color: #d0d0d0;
        }

        .btn-primary {
            background-color: #0066cc;
            color: #fff;
        }

        .btn-primary:hover {
            background-color: #0052a3;
        }

        .theme-toggle {
            background-color: #ffd700;
            color: #1a1a1a;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background-color: #ffed4a;
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        .file-input-label {
            background-color: #0066cc;
            color: #fff;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            background-color: #0052a3;
        }

        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            background-color: #404040;
            border: 1px solid #555;
            color: #fff;
            padding: 6px 30px 6px 10px;
            border-radius: 4px;
            width: 200px;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .search-input::placeholder {
            color: #888;
        }

        .light-theme .search-input {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            color: #333;
        }

        .light-theme .search-input::placeholder {
            color: #666;
        }

        .search-icon {
            position: absolute;
            right: 8px;
            color: #888;
        }

        .main-content {
            padding: 0;
            height: calc(100vh - 60px);
            overflow: auto;
        }

        .table-container {
            background-color: #1a1a1a;
            border: 1px solid #404040;
            border-radius: 6px;
            margin: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .light-theme .table-container {
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: transparent;
        }

        th {
            background-color: #2d2d2d;
            color: #ccc;
            font-weight: 500;
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid #404040;
            position: sticky;
            top: 0;
            z-index: 10;
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
        }

        .light-theme th {
            background-color: #f5f5f5;
            color: #666;
            border-bottom: 1px solid #e0e0e0;
        }

        th:hover {
            background-color: #353535;
        }

        .light-theme th:hover {
            background-color: #e8e8e8;
        }

        .sortable {
            position: relative;
        }

        .sortable:after {
            content: '⇅';
            position: absolute;
            right: 5px;
            opacity: 0.5;
            font-size: 10px;
        }

        .sort-asc:after {
            content: '↑';
            opacity: 1;
        }

        .sort-desc:after {
            content: '↓';
            opacity: 1;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #2d2d2d;
            vertical-align: middle;
            transition: all 0.3s ease;
        }

        .light-theme td {
            border-bottom: 1px solid #f0f0f0;
        }

        tr:hover {
            background-color: #252525;
        }

        .light-theme tr:hover {
            background-color: #f8f8f8;
        }

        .checkbox {
            width: 16px;
            height: 16px;
            accent-color: #0066cc;
        }

        .repo-name {
            color: #4a9eff;
            text-decoration: none;
            font-weight: 500;
        }

        .repo-name:hover {
            text-decoration: underline;
        }

        .author-name {
            font-weight: 500;
            color: #fff;
        }

        .light-theme .author-name {
            color: #333;
        }

        .commit-hash {
            color: #4a9eff;
            text-decoration: none;
            font-family: monospace;
        }

        .commit-hash:hover {
            text-decoration: underline;
        }

        .filename {
            color: #4a9eff;
            text-decoration: none;
            font-family: monospace;
            font-size: 12px;
        }

        .filename:hover {
            text-decoration: underline;
        }

        .verification-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            display: inline-block;
            min-width: 60px;
            text-align: center;
        }

        .verified {
            background-color: #51cf66;
            color: #ffffff;
        }

        .not-verified {
            background-color: #ff6b6b;
            color: #ffffff;
        }

        .filter-input {
            background-color: #2d2d2d;
            border: 1px solid #404040;
            color: #fff;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 4px;
        }

        .filter-input::placeholder {
            color: #666;
        }

        .light-theme .filter-input {
            background-color: #f8f8f8;
            border: 1px solid #d0d0d0;
            color: #333;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .light-theme .empty-state {
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        .stats-container {
            display: flex;
            gap: 20px;
            margin-left: 10px;
        }

        .stat-item {
            font-size: 11px;
            color: #888;
        }

        .stat-value {
            font-weight: 600;
            color: #fff;
        }

        .light-theme .stat-value {
            color: #333;
        }

        .verified-count {
            color: #51cf66;
        }

        .unverified-count {
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <div class="header-title">
                📊 Secret Scanner Results
            </div>
            <div class="header-subtitle" id="dataInfo">No data loaded. Please import a JSON file.</div>
            <div class="stats-container" id="statsContainer" style="display: none;">
                <div class="stat-item">
                    Verified: <span class="stat-value verified-count" id="verifiedCount">0</span>
                </div>
                <div class="stat-item">
                    Unverified: <span class="stat-value unverified-count" id="unverifiedCount">0</span>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="file-input-container">
                <input type="file" id="jsonFileInput" class="file-input" accept=".json" />
                <label for="jsonFileInput" class="file-input-label">
                    📁 Import JSON
                </label>
            </div>
            <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
                🌙 Dark Mode
            </button>
            <button class="btn" onclick="clearData()">
                🗑️ Clear Data
            </button>
            <button class="btn" onclick="exportData()">
                📥 Export
            </button>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Global search..." id="globalSearch">
                <span class="search-icon">🔍</span>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="table-container">
            <div id="emptyState" class="empty-state">
                <h3>No Data Available</h3>
                <p>Click "Import JSON" to load your TruffleHog scan results</p>
                <div class="file-input-container">
                    <input type="file" id="jsonFileInput2" class="file-input" accept=".json" />
                    <label for="jsonFileInput2" class="file-input-label btn-primary">
                        📁 Select JSON File
                    </label>
                </div>
            </div>
            <table id="secretsTable" style="display: none;">
                <thead>
                    <tr>
                        <th width="40">
                            <input type="checkbox" class="checkbox" id="selectAll">
                        </th>
                        <th class="sortable" onclick="sortTable(1)" data-column="repo_name">
                            Repository
                            <input type="text" class="filter-input" placeholder="Filter repo..." onclick="event.stopPropagation()" onkeyup="filterTable()">
                        </th>
                        <th class="sortable" onclick="sortTable(2)" data-column="author_name">
                            Author
                            <input type="text" class="filter-input" placeholder="Filter author..." onclick="event.stopPropagation()" onkeyup="filterTable()">
                        </th>
                        <th class="sortable" onclick="sortTable(3)" data-column="commit">
                            Commit
                            <input type="text" class="filter-input" placeholder="Filter commit..." onclick="event.stopPropagation()" onkeyup="filterTable()">
                        </th>
                        <th class="sortable" onclick="sortTable(4)" data-column="file_name">
                            Filename
                            <input type="text" class="filter-input" placeholder="Filter filename..." onclick="event.stopPropagation()" onkeyup="filterTable()">
                        </th>
                        <th class="sortable" onclick="sortTable(5)" data-column="verified">
                            Verified
                            <input type="text" class="filter-input" placeholder="Filter verified..." onclick="event.stopPropagation()" onkeyup="filterTable()">
                        </th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let secretsData = [];
        let filteredData = [];
        let currentTheme = 'dark';
        let sortDirection = {};

        // Initialize theme from saved preference
        function initializeTheme() {
            const savedTheme = JSON.parse(localStorage.getItem('secretScanner_theme') || '"dark"');
            currentTheme = savedTheme;
            if (currentTheme === 'light') {
                document.body.classList.add('light-theme');
                document.getElementById('themeToggle').textContent = '☀️ Light Mode';
            }
        }

        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            
            if (currentTheme === 'dark') {
                body.classList.add('light-theme');
                themeToggle.textContent = '☀️ Light Mode';
                currentTheme = 'light';
            } else {
                body.classList.remove('light-theme');
                themeToggle.textContent = '🌙 Dark Mode';
                currentTheme = 'dark';
            }
            
            // Save theme preference
            localStorage.setItem('secretScanner_theme', JSON.stringify(currentTheme));
        }

        // File import functionality
        function setupFileInput() {
            const fileInput1 = document.getElementById('jsonFileInput');
            const fileInput2 = document.getElementById('jsonFileInput2');
            
            [fileInput1, fileInput2].forEach(input => {
                input.addEventListener('change', handleFileSelect);
            });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    loadData(jsonData);
                    // Save data to browser storage
                    localStorage.setItem('secretScanner_data', JSON.stringify(jsonData));
                    updateDataInfo(jsonData.length);
                    showTable();
                } catch (error) {
                    alert('Error parsing JSON file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function loadData(data) {
            secretsData = data.map(item => ({
                repo_name: extractRepoName(item.repo_url),
                author_name: extractAuthorName(item.email),
                commit: item.commit || '',
                file_name: extractFileName(item.file_path),
                verified: item.verified || false,
                commit_url: item.commit_url || '',
                repo_url: item.repo_url || '',
                file_path: item.file_path || ''
            }));
            
            filteredData = [...secretsData];
            populateTable();
            updateStats();
        }

        function extractRepoName(url) {
            if (!url) return 'Unknown';
            return url.split('/').pop() || 'Unknown';
        }

        function extractAuthorName(email) {
            if (!email) return 'Unknown';
            const match = email.match(/^([^<]+)</);
            return match ? match[1].trim() : email.split('@')[0];
        }

        function extractFileName(path) {
            if (!path) return 'Unknown';
            return path.split('/').pop() || 'Unknown';
        }

        function updateDataInfo(count) {
            const dataInfo = document.getElementById('dataInfo');
            dataInfo.textContent = `Loaded ${count} secret detections. Showing ${filteredData.length} results.`;
        }

        function updateStats() {
            const verifiedCount = secretsData.filter(item => item.verified).length;
            const unverifiedCount = secretsData.length - verifiedCount;
            
            document.getElementById('verifiedCount').textContent = verifiedCount;
            document.getElementById('unverifiedCount').textContent = unverifiedCount;
            document.getElementById('statsContainer').style.display = 'flex';
        }

        function showTable() {
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('secretsTable').style.display = 'table';
        }

        function populateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            filteredData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                // Shorten commit hash for display
                const shortCommit = item.commit.substring(0, 8);
                
                row.innerHTML = `
                    <td><input type="checkbox" class="checkbox"></td>
                    <td><a href="${item.repo_url}" class="repo-name" target="_blank">${item.repo_name}</a></td>
                    <td><span class="author-name">${item.author_name}</span></td>
                    <td><a href="${item.commit_url}" class="commit-hash" target="_blank">${shortCommit}</a></td>
                    <td><a href="${item.commit_url}" class="filename" target="_blank">${item.file_name}</a></td>
                    <td><span class="verification-status ${item.verified ? 'verified' : 'not-verified'}">${item.verified ? 'Yes' : 'No'}</span></td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function sortTable(columnIndex) {
            const columns = ['', 'repo_name', 'author_name', 'commit', 'file_name', 'verified'];
            const column = columns[columnIndex];
            
            // Toggle sort direction
            if (!sortDirection[column]) {
                sortDirection[column] = 'asc';
            } else if (sortDirection[column] === 'asc') {
                sortDirection[column] = 'desc';
            } else {
                sortDirection[column] = 'asc';
            }
            
            // Update visual indicators
            document.querySelectorAll('.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            
            const currentTh = document.querySelectorAll('.sortable')[columnIndex - 1];
            currentTh.classList.add(sortDirection[column] === 'asc' ? 'sort-asc' : 'sort-desc');
            
            // Sort the data
            filteredData.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                if (column === 'verified') {
                    aVal = aVal ? 1 : 0;
                    bVal = bVal ? 1 : 0;
                }
                
                if (sortDirection[column] === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            populateTable();
        }

        function filterTable() {
            const filters = Array.from(document.querySelectorAll('.filter-input')).map(input => input.value.toLowerCase());
            const columns = ['repo_name', 'author_name', 'commit', 'file_name', 'verified'];
            
            filteredData = secretsData.filter(item => {
                return filters.every((filter, index) => {
                    if (!filter) return true;
                    let value = item[columns[index]];
                    if (columns[index] === 'verified') {
                        value = value ? 'yes' : 'no';
                    }
                    return String(value).toLowerCase().includes(filter);
                });
            });
            
            populateTable();
            updateDataInfo(secretsData.length);
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all data?')) {
                secretsData = [];
                filteredData = [];
                localStorage.removeItem('secretScanner_data');
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('secretsTable').style.display = 'none';
                document.getElementById('statsContainer').style.display = 'none';
                document.getElementById('dataInfo').textContent = 'No data loaded. Please import a JSON file.';
            }
        }

        function exportData() {
            if (secretsData.length === 0) {
                alert('No data to export. Please import a JSON file first.');
                return;
            }
            
            const dataStr = JSON.stringify(secretsData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'secrets_export.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // Search functionality
        document.getElementById('globalSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm === '') {
                filteredData = [...secretsData];
            } else {
                filteredData = secretsData.filter(item => {
                    return Object.values(item).some(value => 
                        String(value).toLowerCase().includes(searchTerm)
                    );
                });
            }
            
            populateTable();
            updateDataInfo(secretsData.length);
        });

        // Load saved data on page load
        function loadSavedData() {
            const savedData = localStorage.getItem('secretScanner_data');
            if (savedData) {
                try {
                    const jsonData = JSON.parse(savedData);
                    loadData(jsonData);
                    updateDataInfo(jsonData.length);
                    showTable();
                } catch (error) {
                    console.error('Error loading saved data:', error);
                }
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            setupFileInput();
            loadSavedData();
        });
    </script>
</body>
</html>
