<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Security Findings Viewer</title>
  <style>
    :root {
      --bg: #0e1015;
      --card: #1a1d23;
      --border: #2a2e35;
      --text: #e3e3e3;
      --accent: #58a6ff;
      --success: #3fb950;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 2rem;
    }

    h1 {
      text-align: center;
      color: var(--accent);
    }

    .upload-box {
      border: 2px dashed var(--accent);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      border-radius: 10px;
      max-width: 600px;
      margin: 0 auto 2rem auto;
      background: var(--card);
    }

    input[type="file"] {
      display: none;
    }

    .finding {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem auto;
      max-width: 700px;
      transition: background 0.3s;
    }

    .finding:hover {
      background: #22252d;
    }

    .finding p {
      margin: 0.5rem 0;
    }

    .report-btn {
      background-color: var(--accent);
      border: none;
      padding: 0.5rem 1rem;
      margin-top: 1rem;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }

    .report-btn:active {
      transform: scale(0.98);
    }

    .copied {
      color: var(--success);
      font-size: 0.9rem;
      margin-left: 10px;
    }
  </style>
</head>
<body>

<h1>Security Report Tool</h1>

<div class="upload-box" onclick="document.getElementById('fileInput').click()">
  Click or Drag a JSON File Here to Load Findings
</div>
<input type="file" id="fileInput" accept=".json" />

<div id="results"></div>

<script>
  const input = document.getElementById("fileInput");
  const results = document.getElementById("results");

  let findings = [];

  input.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const data = JSON.parse(e.target.result);
        if (!Array.isArray(data)) throw "Invalid JSON";

        findings = data;
        localStorage.setItem("securityFindings", JSON.stringify(data));
        renderFindings();
      } catch (err) {
        alert("Error: Invalid JSON file.");
      }
    };
    reader.readAsText(file);
  });

  function renderFindings() {
    results.innerHTML = "";

    findings.forEach((item, index) => {
      const card = document.createElement("div");
      card.className = "finding";

      card.innerHTML = `
        <p><strong>Detector:</strong> ${item.detector}</p>
        <p><strong>Repo URL:</strong> <a href="${item.repo_url}" target="_blank">${item.repo_url}</a></p>
        <p><strong>Commit URL:</strong> <a href="${item.commit_url}" target="_blank">${item.commit_url}</a></p>
        <p><strong>Raw Secret:</strong><br><code>${item.raw_secret}</code></p>
        <button class="report-btn" onclick="copyReport(${index}, this)">Copy Report</button>
        <span class="copied" style="display:none;">Copied!</span>
      `;

      results.appendChild(card);
    });
  }

  function copyReport(index, btn) {
    const item = findings[index];
    const report = `## Security Finding: ${item.detector}

**Raw Secret**  
\`\`\`
${item.raw_secret}
\`\`\`

**Repository URL:** ${item.repo_url}  
**Commit URL:** ${item.commit_url}

_Discovered via automated secret scanning tool._`;

    navigator.clipboard.writeText(report).then(() => {
      const copiedText = btn.nextElementSibling;
      copiedText.style.display = "inline";
      setTimeout(() => {
        copiedText.style.display = "none";
      }, 2000);
    });
  }

  // Load from localStorage if available
  window.onload = () => {
    const saved = localStorage.getItem("securityFindings");
    if (saved) {
      findings = JSON.parse(saved);
      renderFindings();
    }
  };
</script>

</body>
</html>
